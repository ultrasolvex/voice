<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>School Voice â€” Ù†Ø³Ø®Ø© ØªØµØ­ÙŠØ­ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
<style>
  :root{--bg1:#07162a;--bg2:#3a1a63}
  html,body{height:100%;margin:0;font-family:'Tajawal',sans-serif;background:linear-gradient(to bottom,var(--bg1),var(--bg2));color:#fff;display:flex;align-items:center;justify-content:center}
  .card{width:96%;max-width:820px;background:rgba(255,255,255,0.04);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
  h1{margin:0 0 8px;font-size:20px}
  p{margin:6px 0 14px;color:rgba(255,255,255,0.85)}
  .row{display:flex;gap:8px}
  input{flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.08);color:#fff}
  button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:linear-gradient(90deg,#6d2fb0,#2c77ff54);color:#fff}
  .rooms{margin-top:12px;display:flex;flex-direction:column;gap:8px;max-height:180px;overflow:auto;padding-right:6px}
  .room-btn{background:rgba(255,255,255,0.06);border-radius:10px;padding:10px;text-align:center;cursor:pointer}
  .status{margin-top:12px;padding:12px;border-radius:10px;background:rgba(0,0,0,0.25);font-size:14px}
  .participants{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .part{background:rgba(255,255,255,0.06);padding:8px;border-radius:8px;font-size:13px;display:flex;align-items:center;gap:8px}
  .debug{margin-top:12px;font-size:13px;background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;max-height:160px;overflow:auto}
  .mute-btn{background:#ff4d4d;color:#fff;border-radius:8px;padding:6px 8px;border:none;cursor:pointer}
  footer{margin-top:12px;font-size:12px;opacity:.8}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999}
  .overlay button{padding:14px 20px;border-radius:12px;border:none;background:linear-gradient(90deg,#6d2fb0,#2c77ff);font-weight:700;color:#fff}
  audio{display:block;margin-top:6px}
</style>
</head>
<body>
  <div class="card">
    <h1>ğŸ™ï¸ School Voice â€” Ù†Ø³Ø®Ø© ØªØµØ­ÙŠØ­ÙŠØ©</h1>
    <p>Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… ÙˆØ§Ø¶ØºØ· "Ø§Ø¯Ø®Ù„". Ø§ÙØªØ­ Ù†ÙØ³ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø± ÙˆØ§ÙƒØªØ¨ Ù†ÙØ³ Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… Ø¨Ø§Ù„Ø¶Ø¨Ø·.</p>

    <div class="row">
      <input id="roomInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… (Ù…Ø«Ø§Ù„: Ø§Ù„ØµÙ-1)" />
      <button id="joinBtn">Ø§Ø¯Ø®Ù„</button>
      <button id="muteBtn" class="mute-btn" style="display:none">ÙƒØªÙ… Ø§Ù„Ù…Ø§ÙŠÙƒ</button>
    </div>

    <h3 style="margin-top:16px;margin-bottom:6px">ğŸ—‚ Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø©</h3>
    <div id="roomsList" class="rooms">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <h3 style="margin-top:16px;margin-bottom:6px">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙˆÙ† Ø§Ù„Ø¢Ù†</h3>
    <div id="peers" class="participants"><div class="part">Ù„Ø§ Ø£Ø­Ø¯</div></div>

    <div id="status" class="status">Ø§Ù„Ø­Ø§Ù„Ø©: ØºÙŠØ± Ù…ØªØµÙ„</div>

    <div class="debug" id="debugLog"></div>

    <footer>Ø§Ø´ØªØºÙ„ Ø¹Ù„Ù‰ GitHub Pages Ø£Ùˆ Ø£ÙŠ Ø±Ø§Ø¨Ø· HTTPS â€¢ Ø§Ø¶ØºØ· Ø§Ù„Ø´Ø§Ø´Ø© Ø¥Ù† Ù„Ø²Ù… Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</footer>
  </div>

  <!-- Ø³ÙƒØ±ÙŠØ¨Øª -->
<script type="module">
// ==== Firebase imports ====
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import {
  getDatabase, ref, set, update, onValue, push,
  onChildAdded, onChildRemoved, remove, onDisconnect, get, child
} from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

// ==== ØªÙƒÙˆÙŠÙ† Firebase (Ø®Ù„ÙŠÙ‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ Ø¹Ù†Ø¯Ùƒ) ====
const firebaseConfig = {
  apiKey: "AIzaSyAQ6gD7dayX_VRzSIsI5UecS212Ki4N16o",
  authDomain: "school-voice-1b1dc.firebaseapp.com",
  databaseURL: "https://school-voice-1b1dc-default-rtdb.firebaseio.com",
  projectId: "school-voice-1b1dc",
  storageBucket: "school-voice-1b1dc.firebasestorage.app",
  messagingSenderId: "990135804919",
  appId: "1:990135804919:web:38c050a3a2ed1cb8d304f2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ==== Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ====
const joinBtn = document.getElementById("joinBtn");
const roomInput = document.getElementById("roomInput");
const roomsList = document.getElementById("roomsList");
const peersEl = document.getElementById("peers");
const statusEl = document.getElementById("status");
const debugLog = document.getElementById("debugLog");
const muteBtn = document.getElementById("muteBtn");

// ==== Ù…ØªØºÙŠØ±Ø§Øª ====
const peerId = crypto.randomUUID ? crypto.randomUUID() : "p-"+Math.random().toString(36).slice(2,9);
let roomName = null;
let localStream = null;
const pcs = {}, audioEls = {};
let micEnabled = true;
const RTC_CONFIG = { iceServers: [{ urls: "stun:stun.l.google.com:19302" }] };

// Ø³Ø¬Ù„ Ø¯ÙŠØ¨Ø§Øº Ù…Ø®ØªØµØ±
function log(...args){
  console.log(...args);
  const t = document.createElement('div');
  t.textContent = args.map(a=> (typeof a==='object'? JSON.stringify(a): String(a))).join(' ');
  debugLog.appendChild(t);
  debugLog.scrollTop = debugLog.scrollHeight;
}

// ==== Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù†Ù†Ø´Ø¦ Ù…Ø³Ø§Ø± meta Ù„ÙƒÙ„ Ø±ÙˆÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…) ====
onValue(ref(db, "rooms"), (snap)=>{
  const val = snap.val();
  roomsList.innerHTML = "";
  if(!val){ roomsList.innerHTML = "<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆÙ…Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>"; return; }
  Object.keys(val).forEach(r=>{
    const d = document.createElement('div');
    d.className = 'room-btn';
    d.textContent = r;
    d.onclick = ()=>{ roomInput.value = r; joinRoom(); };
    roomsList.appendChild(d);
  });
});

// ==== Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ© ====
joinBtn.onclick = joinRoom;
muteBtn.onclick = () => {
  micEnabled = !micEnabled;
  if(localStream){
    localStream.getAudioTracks().forEach(t => t.enabled = micEnabled);
  }
  muteBtn.textContent = micEnabled ? "ÙƒØªÙ… Ø§Ù„Ù…Ø§ÙŠÙƒ" : "ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø§ÙŠÙƒ";
};

async function joinRoom(){
  const r = roomInput.value.trim();
  if(!r) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹ (Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©)");
  roomName = r;
  statusEl.textContent = 'ğŸ¤ Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…Ø§ÙŠÙƒ...';
  log('Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰', roomName, 'peerId=' + peerId);

  try{
    // Ø§Ø·Ù„Ø¨ Ø§Ù„Ù…Ø§ÙŠÙƒ Ù…Ø¹ Ø®ØµØ§Ø¦Øµ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØª
    localStream = await navigator.mediaDevices.getUserMedia({
      audio: {
        echoCancellation: true,
        noiseSuppression: true,
        autoGainControl: true,
        channelCount: 1
      }
    });
    // Ø§Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„ÙƒØªÙ…
    muteBtn.style.display = 'inline-block';
    micEnabled = true;
    muteBtn.textContent = "ÙƒØªÙ… Ø§Ù„Ù…Ø§ÙŠÙƒ";

    // Ø³Ø¬Ù„ ÙˆØ¬ÙˆØ¯ Ø§Ù„ØºØ±ÙØ© (meta) Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆÙ…Ø§Øª
    const roomMetaRef = ref(db, `rooms/${roomName}/meta`);
    await set(roomMetaRef, { ts: Date.now() });

    // Ø³Ø¬Ù„ ÙˆØ¬ÙˆØ¯ÙŠ Ø¶Ù…Ù† peers
    const myPeerRef = ref(db, `rooms/${roomName}/peers/${peerId}`);
    await set(myPeerRef, { id: peerId, ts: Date.now() });
    onDisconnect(myPeerRef).remove();

    // Ø§Ø³ØªÙ…Ø¹ Ù„ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© peers ÙˆØ¹Ø±Ø¶Ù‡Ø§
    const peersRef = ref(db, `rooms/${roomName}/peers`);
    onValue(peersRef, (snap)=>{
      const data = snap.val() || {};
      const others = Object.keys(data).filter(id=>id!==peerId);
      renderPeersList(others);
      statusEl.textContent = `âœ… Ù…ØªØµÙ„ ÙÙŠ "${roomName}" â€” ${others.length + 1} Ù…ØªØµÙ„(ÙŠÙ†) (Ø£Ù†Øª Ø¶Ù…Ù†Ù‡Ù…)`;
      if(others.length > 3) statusEl.textContent += ' â€” âš ï¸ Ø§Ø²Ø¯Ø­Ø§Ù… Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¯Ø©';
    });

    // Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ù€ signals Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„ÙŠ
    const mySigRef = ref(db, `signals/${roomName}/${peerId}`);
    onChildAdded(mySigRef, async (snap) => {
      const msg = snap.val();
      if(!msg) return;
      log('Ø§Ø³ØªÙ„Ù…Øª Ø±Ø³Ø§Ù„Ø©:', msg.type, 'Ù…Ù†', msg.from);
      const from = msg.from;
      if(msg.type === 'offer'){
        // Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶ -> Ø£Ù†Ø´Ø¦ PC ÙƒÙ…Ø³ØªØ¬ÙŠØ¨
        await ensurePC(from, false);
        const pc = pcs[from];
        try {
          await pc.setRemoteDescription(msg.sdp);
          const answer = await pc.createAnswer();
          await pc.setLocalDescription(answer);
          sendSignal(from, { from: peerId, type: 'answer', sdp: pc.localDescription });
          log('Ø£Ø±Ø³Ù„Øª answer Ø¥Ù„Ù‰', from);
        } catch (e) {
          log('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© offer/answer', e);
        }
      } else if(msg.type === 'answer'){
        const pc = pcs[from];
        if(pc){
          try {
            await pc.setRemoteDescription(msg.sdp);
            log('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ answer Ù…Ù†', from);
          } catch(e){ log('answer setRemoteDescription failed', e); }
        }
      } else if(msg.type === 'ice'){
        const pc = pcs[from];
        if(pc && msg.candidate){
          try { await pc.addIceCandidate(msg.candidate); } catch(e){ log('addIceCandidate failed', e); }
        }
      }
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§ (ØªÙ†Ø¸ÙŠÙ)
      try { remove(snap.ref); } catch(e){ /* ignore */ }
    });

    // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ÙŠÙ† Ø­Ø§Ù„ÙŠØ§ ÙˆØ£Ø±Ø³Ù„ Ù„Ù‡Ù… offer (Ø§Ù„Ù…Ù†Ø¶Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ùˆ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±)
    const currentPeersSnap = await get(ref(db, `rooms/${roomName}/peers`));
    const currentPeers = currentPeersSnap.val() || {};
    for(const id in currentPeers){
      if(id === peerId) continue;
      await ensurePC(id, true); // Ù†Ø¨Ø¯Ø£ offer Ø¥Ù„Ù‰ ÙƒÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„Ù†Ø§
    }

    // Ø¹Ù†Ø¯ Ø­Ø°Ù peer Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© -> Ø§ØºÙ„Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„
    onChildRemoved(peersRef, (snap)=> {
      const id = snap.key;
      if(id && pcs[id]) closePeer(id);
      log('ØªÙ…Øª Ù…ØºØ§Ø¯Ø±Ø©', id);
    });

    statusEl.textContent = `âœ… Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù† ÙÙŠ "${roomName}" â€” Ø§Ù„ØµÙˆØª Ø¬Ø§Ù‡Ø²`;
    log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…');

    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ´ØºÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ â€” Ù†Ø­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØªØ´ØºÙŠÙ„ autoplay
    showPlayHintOnce();

  }catch(err){
    console.error(err);
    log('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ join:', err.message || err);
    alert('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ù…Ø§ÙŠÙƒ Ø£Ùˆ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø§ÙŠÙƒ ÙˆØ§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… getUserMedia.');
    statusEl.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
  }
}

// ==== Ø¥Ù†Ø´Ø§Ø¡/Ø§Ø³ØªØ±Ø¬Ø§Ø¹ RTCPeerConnection ====
async function ensurePC(otherId, makeOffer){
  if(pcs[otherId]) return pcs[otherId];
  log('Ø¥Ù†Ø´Ø§Ø¡ PC Ù…Ø¹', otherId, 'initiator=', makeOffer);
  const pc = new RTCPeerConnection(RTC_CONFIG);
  pcs[otherId] = pc;

  // Ø£Ø¶Ù Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ø§Ù„Ù…ÙŠÙƒ)
  if(localStream) localStream.getTracks().forEach(t => pc.addTrack(t, localStream));

  // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
  pc.ontrack = (ev) => {
    log('ontrack Ù…Ù†', otherId, 'streams=', ev.streams.length);
    if(!audioEls[otherId]){
      const a = document.createElement('audio');
      a.autoplay = true;
      a.playsInline = true;
      a.controls = false;
      // Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªØ­ØªØ§Ø¬ play() Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â€” Ø³Ù†Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹
      try { a.srcObject = ev.streams[0]; } catch(e){ log('set srcObject failed', e); }
      audioEls[otherId] = a;
      renderPeersList(Object.keys(pcs));
      // Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„ (Ù‚Ø¯ ÙŠÙØ´Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø¯ÙˆÙ† ØªÙØ§Ø¹Ù„)
      a.play().catch(()=>{ /* Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */ });
    } else {
      try { audioEls[otherId].srcObject = ev.streams[0]; } catch(e){ log(e); }
    }
  };

  pc.onicecandidate = (evt) => {
    if(evt.candidate) sendSignal(otherId, { from: peerId, type: 'ice', candidate: evt.candidate });
  };

  pc.onconnectionstatechange = () => {
    log('connectionState', otherId, pc.connectionState);
    if(['failed','disconnected','closed'].includes(pc.connectionState)) closePeer(otherId);
  };

  if(makeOffer){
    try {
      const offer = await pc.createOffer({ offerToReceiveAudio: true });
      await pc.setLocalDescription(offer);
      sendSignal(otherId, { from: peerId, type: 'offer', sdp: pc.localDescription });
      log('Ø£Ø±Ø³Ù„Øª offer Ø¥Ù„Ù‰', otherId);
    } catch(e){
      log('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ offer', e);
    }
  }

  return pc;
}

// ==== Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø§Ø±Ø© (signaling) ====
function sendSignal(target, payload){
  try {
    push(ref(db, `signals/${roomName}/${target}`), payload);
  } catch(e){ log('sendSignal failed', e); }
}

// ==== Ø§ØºÙ„Ø§Ù‚ peer ÙˆØªÙ†Ø¸ÙŠÙ ====
function closePeer(id){
  const pc = pcs[id];
  if(pc){
    try { pc.close(); } catch(e){}
    delete pcs[id];
  }
  if(audioEls[id]){
    try { audioEls[id].srcObject = null; } catch(e){}
    try { audioEls[id].remove(); } catch(e){}
    delete audioEls[id];
  }
  renderPeersList(Object.keys(pcs));
}

// ==== Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ù…Ø¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª ==== 
function renderPeersList(list){
  peersEl.innerHTML = '';
  if(!list || list.length === 0){ peersEl.innerHTML = '<div class="part">Ù„Ø§ Ø£Ø­Ø¯</div>'; return; }
  list.forEach(id => {
    const d = document.createElement('div');
    d.className = 'part';
    d.textContent = 'Ù…Ø³ØªØ®Ø¯Ù… ' + id.slice(0,6);
    if(audioEls[id]) d.appendChild(audioEls[id]);
    peersEl.appendChild(d);
  });
}

// ==== Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ†Ø¸ÙŠÙ: Ø§Ø²Ø§Ù„Ø© Ø§Ù„ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====
window.addEventListener('beforeunload', ()=>{
  try { remove(ref(db, `rooms/${roomName}/peers/${peerId}`)); } catch(e){}
});

// ==== Ø¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ ====
let playHintShown = false;
function showPlayHintOnce(){
  if(playHintShown) return;
  playHintShown = true;

  // Ø¹Ø±Ø¶ overlay Ø¨Ø³ÙŠØ· ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¶ØºØ· Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù† Ù„Ù… ØªØ¹Ù…Ù„ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  const ov = document.createElement('div');
  ov.className = 'overlay';
  const btn = document.createElement('button');
  btn.textContent = 'Ø§Ø¶ØºØ· Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª (Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„)';
  ov.appendChild(btn);
  document.body.appendChild(ov);

  btn.onclick = () => {
    // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙˆØª
    Object.values(audioEls).forEach(a => { try { a.play().catch(()=>{}); } catch{} });
    // Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ù…Ø³Ø§Ø± Ù…Ø­Ù„ÙŠ (Ø§Ø®ØªØ¨Ø§Ø±) ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„Ù‡ ÙƒØ°Ù„Ùƒ
    document.body.removeChild(ov);
  };

  // Ø¥Ø°Ø§ Ø®Ù„Ø§Ù„ 4 Ø«ÙˆØ§Ù†ÙŠ ØªÙ… ØªØ´ØºÙŠÙ„ Ø´ÙŠØ¡ØŒ Ù†ØºÙ„Ù‚ Ø§Ù„Ù€ overlay ØªÙ„Ù‚Ø§Ø¦ÙŠØ§
  setTimeout(()=>{ if(document.body.contains(ov)) { /* Ù„Ø§ ØªÙØºÙ„Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ø¶ØºØ· */ } }, 4000);
}

// ==== Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹Ø±Ù peer Ù„Ù„Ù€ debug ====
log('peerId:', peerId);
</script>
</body>
</html>  

